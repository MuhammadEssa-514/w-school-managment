"use strict";var WPFormsStripePaymentElement=window.WPFormsStripePaymentElement||function(e,i,d){let s,m={stripe:null,forms:{},init:function(){m.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale,betas:["elements_enable_deferred_intent_beta_1"]}),d(e).on("wpformsReady",function(){m.initializeFormsDefaultObject(),d(".wpforms-stripe form").each(m.setupStripeForm),d(".wpforms-field-stripe-credit-card").on("wpformsConvFormsFieldActivationAfter",m.convFormsFieldActivationAfter)}),d(e).on("wpformsBeforePageChange",m.pageChange).on("wpformsAmountTotalCalculated",m.updateElementsTotalAmount).on("wpformsProcessConditionalsField",function(e,o,r,t,n){m.processConditionalsField(o,r,t,n)})},initializeFormsDefaultObject:function(){d(".wpforms-stripe form").each(function(){var e=d(this).data("formid");m.forms[e]={elements:null,paymentElement:null,elementsModified:!1,linkElement:null,linkEmail:"",linkDestroyed:!1,paymentType:"",lockedPageToSwitch:0,paymentMethodId:"",total:""}})},setupStripeForm:function(){var e,o=d(this),r=o.find(".wpforms-field-stripe-credit-card");r.find(".wpforms-field-row").length&&(e=o.data("validator"))&&(s=e.settings.submitHandler,e.settings.submitHandler=m.submitHandler,o.on("wpformsAjaxSubmitActionRequired",m.confirmPaymentActionCallback),r.hasClass("wpforms-conditional-field")||m.setupPaymentElement(o))},confirmPaymentActionCallback:async function(e,o){if(o.success&&o.data.action_required){const n=d(this);var r=new URL(i.location.href),t=n.data("formid");await m.stripe.confirmPayment({clientSecret:o.data.payment_intent_client_secret,confirmParams:{return_url:r.toString(),payment_method:m.forms[t].paymentMethodId},redirect:"if_required"}).then(function(e){m.handleConfirmPayment(n,e)})}},handleConfirmPayment:function(e,o){var r;o.error?m.displayStripeError(e,o.error.message):(r=e.data("formid"),o.paymentIntent&&"succeeded"===o.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+o.paymentIntent.id+'">'),e.append('<input type="hidden" class="wpforms-stripe-payment-link-email" name="wpforms[payment_link_email]" value="'+m.forms[r].linkEmail+'">'),wpforms.formSubmitAjax(e)):m.formAjaxUnblock(e))},setupPaymentElement:function(e){var o=e.data("formid");d.isEmptyObject(m.forms)&&m.initializeFormsDefaultObject(),m.forms[o].paymentElement||(m.forms[o].elements=m.stripe.elements({currency:wpforms.getCurrency().code.toLowerCase(),mode:"payment",amount:77777,loader:"always",locale:wpforms_stripe.data.element_locale,appearance:m.getElementAppearanceOptions(e)}),m.initializePaymentElement(e),m.linkEmailMappedFieldTriggers(e),wpforms.amountTotalCalc(e),m.updatePaymentElementStylesModern(e))},processConditionalsField:function(e,o,r,t){var n=d("#wpforms-form-"+e),i=n.find(".wpforms-field-stripe-credit-card"),r=r&&"hide"===t||!r&&"hide"!==t;!i.length||i.data("field-id").toString()!==o||m.forms[e].paymentElement||r||m.setupPaymentElement(n)},getElementAppearanceOptions:function(e){var o,r;return"object"==typeof i.wpformsStripePaymentElementAppearance?i.wpformsStripePaymentElementAppearance:(r=e.find(".wpforms-stripe-credit-card-hidden-input"),o=!(e=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row")).hasClass("wpforms-sublabel-hide"),r={borderColor:r.css("border-color"),borderRadius:r.css("border-radius"),fontSize:r.css("font-size"),colorPrimary:r.css("color"),colorText:r.css("color"),colorBackground:r.css("background-color"),fontFamily:r.css("font-family")},i.WPForms&&WPForms.FrontendModern&&(r.colorPrimary=WPForms.FrontendModern.getSolidColor(r.colorPrimary)),{theme:"none",labels:e.data("sublabel-position"),sublabelHide:o,variables:{colorPrimary:r.colorPrimary,colorBackground:r.colorBackground,colorText:r.colorText,colorDanger:"#990000",fontFamily:r.fontFamily,spacingUnit:"4px",spacingGridRow:"8px",fontSizeSm:"13px",fontWeightNormal:"400",borderRadius:r.borderRadius},rules:{".Input--invalid":{color:r.colorText,borderColor:"#cc0000"},".Input":{border:"1px solid "+r.borderColor,borderRadius:r.borderRadius,boxShadow:"none",fontSize:r.fontSize,padding:"6px 10px",lineHeight:"24px",transition:"none"},".Input:focus":{border:"1px solid #999",boxShadow:"none",outline:"none"},".Label":{fontFamily:r.fontFamily,lineHeight:o?"1.3":"0",opacity:Number(o),color:"#000000"},".CheckboxInput, .CodeInput, .PickerItem":{border:"1px solid "+r.borderColor},".Tab, .Block":{border:"1px solid "+r.borderColor,borderRadius:r.borderRadius},".Tab--selected":{borderColor:"#999999"},".Action":{marginLeft:"6px"},".Action, .MenuAction":{border:"none",backgroundColor:"transparent"},".Action:hover, .MenuAction:hover":{border:"none",backgroundColor:"transparent"}}})},initializePaymentElement:function(o,e=""){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row");let t=o.data("formid");m.forms[t].paymentElement&&m.forms[t].paymentElement.destroy(),m.forms[t].paymentElement=m.forms[t].elements.create("payment",{defaultValues:{billingDetails:{email:e}}}),m.mountPaymentElement(o),m.forms[t].paymentElement.on("change",function(e){m.forms[t].paymentType=e.value.type,r.data("link-email")||("google_pay"===e.value.type||"apple_pay"===e.value.type?(m.forms[t].linkElement.destroy(),m.forms[t].linkDestroyed=!0):m.forms[t].linkDestroyed&&(m.initializeLinkAuthenticationElement(o),m.forms[t].linkDestroyed=!1)),r.data("type",e.value.type),e.empty?(r.data("completed",!1),r.find("label.wpforms-error").toggle("card"===e.value.type)):(m.forms[t].elementsModified=!0,e.complete?(r.data("completed",!0),m.hideStripeFieldError(o)):r.data("completed",!1))}),m.forms[t].paymentElement.on("loaderror",function(e){m.displayStripeLoadError(o,e.error.message)})},mountPaymentElement:function(e){var e=e.data("formid"),o="#wpforms-field-stripe-payment-element-"+e;m.forms[e].paymentElement.mount(o)},linkEmailMappedFieldTriggers:function(e){const o=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row");let r=m.getMappedLinkEmailField(e),t=e.data("formid");r?r.on("change",function(){m.forms[t].linkEmail=d(this).val(),o.data("completed")||m.initializePaymentElement(e,d(this).val())}):(o.data("linkCompleted",!1),m.initializeLinkAuthenticationElement(e))},getMappedLinkEmailField(e){var o=e.data("formid"),e=e.find(".wpforms-field-stripe-credit-card .wpforms-field-row").data("link-email");return e?d(`#wpforms-${o}-field_`+e):null},initializeLinkAuthenticationElement:function(o){const r=o.find(".wpforms-field-stripe-credit-card .wpforms-field-row");let t=o.data("formid");m.forms[t].linkElement=m.forms[t].elements.create("linkAuthentication"),m.mountLinkElement(o),m.forms[t].linkElement.on("change",function(e){e.empty||(m.forms[t].elementsModified=!0,e.complete?(void 0!==e.value.email&&(m.forms[t].linkEmail=e.value.email),r.data("linkCompleted",!0),m.hideStripeFieldError(o)):r.data("linkCompleted",!1))}),m.forms[t].linkElement.on("loaderror",function(e){m.displayStripeLoadError(o,e.error.message)})},mountLinkElement:function(e){var e=e.data("formid"),o="#wpforms-field-stripe-link-element-"+e;m.forms[e].linkElement.mount(o)},submitHandler:function(e){var e=d(e),o=e.find(".wpforms-field-stripe-credit-card"),r=o.find(".wpforms-field-row");let t=e.validate().form(),n=e.data("formid"),i=r.data("required"),a=!r.data("link-email")&&m.forms[n].elementsModified||r.data("completed"),l=!1;o.hasClass("wpforms-conditional-hide")||(l=i||a&&!i),t&&l?(e.find(".wpforms-submit").prop("disabled",!0),e.find(".wpforms-submit-spinner").show(),m.createPaymentMethod(e)):t?s(e):(e.find(".wpforms-submit").prop("disabled",!1),e.validate().cancelSubmit=!0)},updateElementsTotalAmount:function(e,o,r){var t;r&&(t=wpforms.getCurrency(),o=o.data("formid"),m.forms[o])&&m.forms[o].elements&&(m.forms[o].total=r,m.forms[o].elements.update({amount:parseInt(wpforms.numberFormat(r,t.decimals,"",""),10)}))},createPaymentMethod:async function(r){let t=r.data("formid");m.forms[t].total?await m.stripe.createPaymentMethod({elements:m.forms[t].elements}).then(function(e){var o;e.error?(o=["incomplete_email","email_invalid","incomplete_number","invalid_number","incomplete_expiry","invalid_expiry_year_past","invalid_expiry_year","incomplete_cvc","incomplete_name","incomplete_phone_number","empty_phone_number"].includes(e.error.code)?"":e.error.message,m.displayStripeFieldError(r,o)):(m.forms[t].paymentMethodId=e.paymentMethod.id,r.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+m.forms[t].paymentMethodId+'">'),s(r))}):s(r)},formAjaxUnblock:function(e){var o=e.find(".wpforms-submit"),r=o.data("submit-text");r&&o.text(r),o.prop("disabled",!1),o.removeClass("wpforms-disabled"),e.closest(".wpforms-container").css("opacity",""),e.find(".wpforms-submit-spinner").hide()},displayStripeError:function(e,o){wpforms.clearFormAjaxGeneralErrors(e),wpforms.displayFormAjaxErrors(e,o),m.formAjaxUnblock(e)},displayStripeFieldError:function(e,o){var r=e.find(".wpforms-stripe-credit-card-hidden-input").attr("name"),t=e.find(".wpforms-field-stripe-credit-card"),n={};o&&(n[r]=o),wpforms.displayFormAjaxFieldErrors(e,n),wpforms.scrollToError(t),m.formAjaxUnblock(e)},hideStripeFieldError:function(e){e.find(".wpforms-field-stripe-credit-card .wpforms-error").hide()},displayStripeLoadError:function(e,o){o=wpforms_stripe.i18n.element_load_error+"<br /> "+o,m.displayStripeError(e,o)},pageChange:function(e,o,r,t){var n=r.find(".wpforms-field-stripe-credit-card .wpforms-field-row"),i=r.data("formid");n.length&&-1!==["card","link"].indexOf(m.forms[i].paymentType)&&(m.forms[i].elementsModified||"card"!==m.forms[i].paymentType||(m.forms[i].paymentElement.unmount(),m.mountPaymentElement(r),n.data("link-email"))||(m.forms[i].linkElement.unmount(),m.mountLinkElement(r)),!n.is(":visible")||!n.data("required")&&!m.forms[i].elementsModified||m.forms[i].lockedPageToSwitch&&m.forms[i].lockedPageToSwitch!==o||"prev"===t||(t=void 0===n.data("linkCompleted")||n.data("linkCompleted"),n.data("completed")&&t?m.hideStripeFieldError(r):(m.forms[i].lockedPageToSwitch=o,m.displayStripeFieldError(r,wpforms_stripe.i18n.empty_details),e.preventDefault())))},convFormsFieldActivationAfter:function(e,o){m.setupPaymentElement(o.$el.closest("form"))},getCssVar:function(e,o){let r=e.getPropertyValue(o).trim();return r=o.includes("color")?r.replace(/\s/g,""):r},updatePaymentElementStylesModern:function(e){var o;i.WPForms&&WPForms.FrontendModern&&e&&0!==e.length&&(o=e.data("formid"),m.forms[o])&&(o=m.forms[o].elements,e=WPForms.FrontendModern.getCssVars(e),m.updateFormElementsAppearance(o,e))},updateFormElementsAppearance:function(e,o){var r;e&&e._commonOptions&&(r=e._commonOptions.appearance,o["field-size-padding-v"]=(parseInt(o["field-size-input-height"],10)-parseInt(o["field-size-font-size"],10)-6)/2+"px",r.variables.spacingGridRow=o["field-size-input-spacing"],r.variables.spacingGridColumn="20px",r.variables.spacingTab="10px",r.variables.colorText=WPForms.FrontendModern.getSolidColor(o["field-text-color"]),r.rules={".Input":{border:"1px solid "+o["field-border-color"],borderRadius:o["field-border-radius"],padding:o["field-size-padding-v"]+" "+o["field-size-padding-h"],fontSize:o["field-size-font-size"],lineHeight:o["field-size-font-size"],backgroundColor:o["field-background-color"],boxShadow:"none",outline:"none"},".Input:focus":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".Input--invalid":{borderColor:o["label-error-color"],boxShadow:"none",color:r.variables.colorText,outline:"none"},".Input--invalid:focus":{borderColor:o["label-error-color"],boxShadow:"0 0 0 1px "+o["label-error-color"],outline:"none"},".Input::placeholder":{color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5"),fontSize:o["field-size-font-size"]},".CheckboxInput":{border:"1px solid "+o["field-border-color"],backgroundColor:o["field-background-color"]},".CheckboxInput--checked":{borderColor:o["button-background-color"],backgroundColor:o["button-background-color"]},".CodeInput":{border:"1px solid "+o["field-border-color"]},".CodeInput:focus":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"],outline:"none"},".CodeInput:disabled":{borderColor:WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),color:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.5")},".Label":{fontSize:o["label-size-sublabel-font-size"],margin:`0 0 ${o["field-size-sublabel-spacing"]} 0`,color:o["label-sublabel-color"],opacity:Number(Boolean(r?.sublabelHide)),lineHeight:r?.sublabelHide?"inherit":"0"},".Error":{fontSize:o["label-size-sublabel-font-size"],margin:o["field-size-sublabel-spacing"]+" 0 0 0",color:o["label-error-color"]},".Tab":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),borderRadius:o["field-border-radius"],backgroundColor:"transparent",boxShadow:"none",marginTop:"0"},".Tab:focus":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.5"),boxShadow:"0 0 0 3px "+WPForms.FrontendModern.getColorWithOpacity(o["button-background-color"],"0.25"),outline:"none"},".Tab:hover":{border:"1px solid "+o["field-border-color"]},".Tab--selected":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"],backgroundColor:o["field-background-color"]},".Tab--selected:hover":{borderColor:o["button-background-color"]},".Tab--selected:focus":{borderColor:o["button-background-color"],boxShadow:"0 0 0 1px "+o["button-background-color"]},".TabLabel":{color:o["field-text-color"]},".TabIcon":{fill:WPForms.FrontendModern.getColorWithOpacity(o["field-text-color"],"0.75")},".TabIcon--selected":{fill:o["field-text-color"]},".TabIcon:hover":{color:o["field-text-color"],fill:o["field-text-color"]},".TabLabel--selected":{color:o["button-background-color"]},".Block":{border:"1px solid "+WPForms.FrontendModern.getColorWithOpacity(o["field-border-color"],"0.5"),borderRadius:o["field-border-radius"],boxShadow:"none"}},e.update({appearance:r}))}};return m}(document,window,jQuery);WPFormsStripePaymentElement.init();
"use strict";let WPFormsPaymentsOverview=window.WPFormsPaymentsOverview||function(e,t,o,r,a){const i={},l={chart:null,datepicker:null,locale:a.locale,currency:a.currency,nonce:a.nonce,data:[],type:1===a.settings.graph_style?"bar":"line",delimiter:a.delimiter,get currentPageUri(){return new URL(a.page_uri)},classNames:{hide:"wpforms-hide",ready:"is-ready",fetching:"doing-ajax",selected:"is-selected",calculated:"is-calculated"},timespan:"",report:a.active_report,isAmount:!1,get colors(){var e="line"===this.type;return{total_payments:{hoverBorderColor:"#055f9a",hoverBackgroundColor:"#055f9a",borderColor:"#056aab",backgroundColor:e?"#e6f0f7":"#056aab"},total_sales:{hoverBorderColor:"#00831e",hoverBackgroundColor:"#00831e",borderColor:"#008a20",backgroundColor:e?"#e3f3e4":"#008a20"},default:{hoverBorderColor:"#cd6622",hoverBackgroundColor:"#cd6622",borderColor:"#e27730",backgroundColor:e?"#fcf1ea":"#e27730"}}},get i18n(){return a.i18n},get xAxesDisplayFormat(){var e;return!this.timespan.length||(e=this.timespan.split(this.delimiter),!Array.isArray(e))||2!==e.length||moment(e[0]).format("YYYY")===moment(e[1]).format("YYYY")?"MMM D":"MMM D YYYY"},get amountFormatter(){return new Intl.NumberFormat(this.locale,{style:"currency",useGrouping:!0,currencyDisplay:"narrowSymbol",currency:this.currency})},get datasetLabel(){var e=o(`[data-stats=${this.report}]`);return e.length?e.find(".statcard-label").text():this.i18n?.label},get settings(){return{type:this.type,data:{labels:[],datasets:[{data:[],label:"",borderWidth:2,pointRadius:4,pointBorderWidth:1,...{pointBackgroundColor:"#ffffff",...this.colors[this.report]||this.colors.default}}]},options:{layout:{padding:{left:15,right:19,top:25,bottom:9}},scales:{xAxes:[{type:"time",offset:"bar"===this.type,maxBarThickness:100,time:{unit:"day",displayFormats:{day:this.xAxesDisplayFormat}},distribution:"series",ticks:{beginAtZero:!0,source:"labels",padding:10,fontColor:"#a7aaad",labelOffset:10,fontSize:13,minRotation:25,maxRotation:25,callback:function(e,t,a){var r=Math.floor(a.length/7);return r<1||(a.length-t-1)%r==0?e:void 0}}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:20,fontColor:"#a7aaad",fontSize:13,callback:e=>this.isAmount?this.amountFormatter.format(e):Math.floor(e)===e?e:void 0}}]},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0},legend:{display:!1},tooltips:{displayColors:!1,callbacks:{label:({yLabel:e})=>{let t=this.datasetLabel+" ";return this.isAmount?t+=this.amountFormatter.format(e):t+=e}}},responsiveAnimationDuration:0,maintainAspectRatio:!1}}}},n={init:function(){o(n.ready)},ready:function(){n.setup(),n.bindEvents(),n.initDatePicker(),n.initChart()},setup:function(){i.$document=o(e),i.$wrapper=o(".wpforms-payments-wrap-overview"),i.$spinner=o(".wpforms-overview-chart .spinner"),i.$canvas=o("#wpforms-payments-overview-canvas"),i.$filterBtn=o("#wpforms-datepicker-popover-button"),i.$datepicker=o("#wpforms-payments-overview-datepicker"),i.$filterForm=o(".wpforms-overview-top-bar-filter-form"),i.$table=o(".wpforms-table-list"),i.$notice=o(".wpforms-overview-chart-notice"),i.$reports=o(".wpforms-payments-overview-reports")},bindEvents:function(){i.$document.on("click",{selectors:[".wpforms-datepicker-popover",".wpforms-dash-widget-settings-menu"]},n.handleOnClickOutside),i.$wrapper.on("submit",".wpforms-overview-top-bar-filter-form",n.handleOnSubmitDatepicker).on("click",'.wpforms-overview-top-bar-filter-form [type="reset"]',n.handleOnResetDatepicker).on("change",'.wpforms-overview-top-bar-filter-form [type="radio"]',n.handleOnUpdateDatepicker).on("click",".wpforms-payments-overview-reports button",n.handleOnChangeStatCard).on("click",".wpforms-dash-widget-settings-menu-save",n.handleOnSaveSettings).on("click","#wpforms-payments-mode-toggle",n.handleOnToggleMode).on("click","#wpforms-dash-widget-settings-button",{selector:".wpforms-dash-widget-settings-menu",hide:".wpforms-datepicker-popover"},n.handleOnToggle).on("click","#wpforms-datepicker-popover-button",{selector:".wpforms-datepicker-popover",hide:".wpforms-dash-widget-settings-menu"},n.handleOnToggle)},initDatePicker:function(){i.$datepicker.length&&(l.timespan=i.$datepicker.val(),l.datepicker=flatpickr(i.$datepicker,{mode:"range",inline:!0,allowInput:!1,enableTime:!1,clickOpens:!1,altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",locale:{...flatpickr.l10ns[l.locale]||{},rangeSeparator:l.delimiter},onChange:function(e,t,a){var r=i.$filterForm.find('input[value="custom"]');r.prop("checked",!0),n.selectDatepickerChoice(r.parent()),t&&i.$filterBtn.text(a.altInput.value)}}),this.handleOnUpdateDatepicker({},i.$filterForm.find('input[value="custom"]').prop("checked")))},handleOnSubmitDatepicker:function(){o(this).find('input[type="radio"]').attr("name",""),n.hideElm(i.$filterBtn.next())},handleOnResetDatepicker:function(e){e.preventDefault(),i.$filterForm.get(0).reset(),n.hideElm(i.$filterBtn.next()),n.handleOnUpdateDatepicker()},handleOnUpdateDatepicker:function(e=0,t=!1){var a=i.$filterForm.find("input:checked"),r=a.parent(),a=t?i.$datepicker:a,s=a.val().split(l.delimiter);i.$filterBtn.text(t?a.next().val():r.text()),n.selectDatepickerChoice(r),Array.isArray(s)&&2===s.length?l.datepicker.setDate(s):l.datepicker.clear()},initChart:function(){var e,t;i.$canvas.length&&(e=i.$canvas.get(0).getContext("2d"),t=i.$reports.find("."+l.classNames.selected),l.report=t.data("stats"),l.isAmount=t.hasClass("is-amount"),l.chart=new Chart(e,l.settings),this.updateChartByReport())},handleOnChangeStatCard:function(e){e.preventDefault();e=o(this);e.hasClass(l.classNames.selected)||e.hasClass("disabled")||(n.spinner(),l.report=e.data("stats"),l.isAmount=e.hasClass("is-amount"),i.$reports.find("button").removeClass(l.classNames.selected),e.addClass(l.classNames.selected),n.updateChartByReport())},handleOnSaveSettings:function(e){e.preventDefault();var e=o(this).closest(".wpforms-dash-widget-settings-container").find('input[name="wpforms-style"]:checked').val(),t=(l.type=1===Number(e)?"bar":"line",Object.assign({},l.settings)),a=(t.data.labels=l.chart.data.labels,t.data.datasets[0].data=l.chart.data.datasets[0].data,l.chart.destroy(),i.$canvas.get(0).getContext("2d"));l.chart=new Chart(a,t),o.post(r,{graphStyle:e,_ajax_nonce:l.nonce,action:"wpforms_payments_overview_save_chart_preference_settings"}).done(function(){i.$wrapper.find(".wpforms-dash-widget-settings-menu").hide()})},handleOnToggleMode:function(){var e=l["currentPageUri"];e.searchParams.set("mode",this.checked?"test":"live"),t.location.href=e.href},handleOnToggle:function(e){e.preventDefault(),e.stopPropagation();const{selector:t,hide:a}=e["data"];i.$wrapper.find(t).toggle(0,function(){var e=o(t);e.attr("aria-expanded",e.is(":visible"))}),n.hideElm(i.$wrapper.find(a))},handleOnClickOutside:function(e){const{target:a,data:{selectors:t}}=e;o.each(t,function(e,t){o(a).closest(t+":visible").length||n.hideElm(i.$wrapper.find(t))})},processDatasetData:function(e){const r=[],s=[];if(o.isPlainObject(e)&&0<Object.keys(e).length)i.$notice.addClass(l.classNames.hide),o.each(e||[],function(e,t){var a=moment(t.day);r.push(a),s.push({t:a,y:t?.count||0})});else{var t,e=l["i18n"]["no_dataset"],a=(e?.[l.report]&&i.$notice.find("h2").text(e[l.report]),i.$notice.removeClass(l.classNames.hide),moment().startOf("day"));for(let e=1;e<=30;e++)t=a.clone().subtract(e,"days"),r.push(t),s.push({t:t,y:Math.floor(16*Math.random())+5})}return{labels:r,datasets:s}},updateChart:function(e){var{labels:e,datasets:t}=n.processDatasetData(e||[]);l.chart.data.labels=e,l.chart.data.datasets[0]=l.settings.data.datasets[0],l.chart.data.datasets[0].data=t,l.chart.update(),i.$spinner.addClass(l.classNames.hide)},updateChartByReport:function(e){l.report&&Object.hasOwn(l.data,l.report)?n.updateChart(l.data[l.report]?.data||[]):(i.$reports.addClass(l.classNames.fetching),o.post(r,o.extend({},{report:l.report,dates:l.timespan,_ajax_nonce:l.nonce,action:"wpforms_payments_overview_refresh_chart_dataset_data"},e),function({data:e}){l.data=Object.assign({[l.report]:e},l.data),n.updateChart(e?.data||[]),n.updateReports(e?.reports||{})}).done(function(){i.$reports.addClass(l.classNames.ready),i.$reports.removeClass(l.classNames.fetching)}))},updateReports:function(n){o.isEmptyObject(n)||i.$reports.find("li").each(function(){var e=o(this),t=e.find("button");if(t.hasClass("disabled"))return!0;var a=t.data("stats"),r=n[a]||0,a=Number(n[a+"_delta"])||0,s=e.find(".statcard-value"),e=e.find(".statcard-delta");s.addClass(l.classNames.calculated).html(r),e.addClass(l.classNames.calculated).html(Math.abs(a)),0!==a&&e.addClass(Number(0<a)?"is-upward":"is-downward"),t.hasClass("is-amount")&&s.attr("title",s.text())})},selectDatepickerChoice:function(e){i.$filterForm.find("label").removeClass(l.classNames.selected),e.addClass(l.classNames.selected)},spinner:function(){i.$spinner.removeClass(l.classNames.hide)},hideElm:function(e){e.attr("aria-expanded","false").hide()}};return n}(document,window,jQuery,ajaxurl,wpforms_admin_payments_overview);WPFormsPaymentsOverview.init();
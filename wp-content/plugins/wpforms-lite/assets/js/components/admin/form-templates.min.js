"use strict";var WPFormsFormTemplates=window.WPFormsFormTemplates||function(t,w){var g={},_={init:function(){w(_.ready),w(t).on("load",function(){"function"==typeof w.ready.then?w.ready.then(_.load):_.load()})},ready:function(){_.setup(),_.events()},load:function(){_.showUpgradeBanner()},setup:function(){g.templateList=new List("wpforms-setup-templates-list",{valueNames:["wpforms-template-name","wpforms-template-desc",{name:"slug",attr:"data-slug"},{name:"categories",attr:"data-categories"},{name:"has-access",attr:"data-has-access"},{name:"favorite",attr:"data-favorite"}]})},events:function(){w("#wpforms-setup-templates-list").on("click",".wpforms-template-favorite i",_.selectFavorite)},selectFavorite:function(t){function e(){u.favorite=!1,f-=1,d.values(u),v(),l.data("data-favorite",0),p.html(f),_.maybeHideFavoritesCategory()}function a(){u.favorite=!0,f+=1,d.values(u),v(),l.data("data-favorite",1),p.html(f),_.maybeHideFavoritesCategory()}let s=w(this),o=s.hasClass("fa-heart-o"),n=s.closest(".wpforms-template-favorite"),r=s.closest(".wpforms-template"),l=r.find(".wpforms-template-name"),i=r.find(".wpforms-template-select").data("slug"),m=w(".wpforms-setup-templates-categories").find("[data-category='favorites']"),p=m.find("span"),f=parseInt(p.html(),10),c={action:"wpforms_templates_favorite",slug:i,favorite:o,nonce:wpforms_form_templates.nonce},d=g.templateList.get("slug",i)[0],u=d.values(),v=function(){n.find(".fa-heart-o").toggleClass("wpforms-hidden",u.favorite),n.find(".fa-heart").toggleClass("wpforms-hidden",!u.favorite)};w.post(wpforms_form_templates.ajaxurl,c,function(t){t.success||(o?e:a)()}),(o?a:e)()},maybeHideFavoritesCategory:function(){var t=w(".wpforms-setup-templates-categories"),e=t.find("[data-category='favorites']"),a=parseInt(e.find("span").html(),10);e.toggleClass("wpforms-hidden",!a),e.hasClass("active")&&(a?e:t.find("[data-category='all']")).trigger("click")},searchTemplate:function(t){_.performSearch(w(this).val()),_.showUpgradeBanner()},performSearch(t){t=g.templateList.search(t);w(".wpforms-templates-no-results").toggle(!t.length)},selectCategory:function(t){t.preventDefault();let e=w(this),a=e.closest("ul").find(".active"),s=e.data("category"),o=w("#wpforms-setup-template-search").val();a.removeClass("active"),e.addClass("active"),g.templateList.filter(function(t){return"available"===s?t.values()["has-access"]:"favorites"===s?t.values().favorite:"all"===s||-1<t.values().categories.split(",").indexOf(s)}),""!==o&&_.performSearch(o),_.showUpgradeBanner()},selectTemplateCancel:function(){var t=w("#wpforms-setup-templates-list").find(".wpforms-template.active"),e=t.find(".wpforms-template-select");t.removeClass("active"),e.html(e.data("labelOriginal"))},showUpgradeBanner:function(){var t,e;w("#tmpl-wpforms-templates-upgrade-banner").length&&(t=wp.template("wpforms-templates-upgrade-banner"))&&(5<(e=w("#wpforms-setup-templates-list .wpforms-template")).length?e.eq(5):e.last()).after(t())},selectTemplateProcess:function(t,e,a,s){a.data("addons")?_.addonsModal(t,e,a,s):s(t,e)},addonsModal:function(t,e,a,s){var o=a.data("template-name-raw"),n=a.data("addons-names"),a=a.data("addons").split(",");let r=1<a.length?wpforms_form_templates.template_addons_prompt:wpforms_form_templates.template_addon_prompt;r=r.replace(/%template%/g,o).replace(/%addons%/g,n),a.length&&(wpforms_form_templates.can_install_addons?_.userCanInstallAddonsModal(t,e,a,r,s):_.userCannotInstallAddonsModal(r))},userCanInstallAddonsModal:function(t,e,a,s,o){w.confirm({title:wpforms_form_templates.heads_up,content:s,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.install_confirm,btnClass:"btn-confirm",keys:["enter"],action:function(){return this.$$confirm.prop("disabled",!0).html('<i class="wpforms-loading-spinner wpforms-loading-white wpforms-loading-inline"></i>'+wpforms_form_templates.activating),this.$$cancel.prop("disabled",!0),_.installActivateAddons(a,this,t,e,o),!1}},cancel:{text:wpforms_form_templates.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},userCannotInstallAddonsModal:function(t){w.alert({title:wpforms_form_templates.heads_up,content:t,icon:"fa fa-exclamation-circle",type:"orange",buttons:{ok:{text:wpforms_form_templates.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},installActivateAddons:function(t,e,a,s,o){const n=[],r=[];let l=!1;t.forEach(function(e){l="function"!=typeof l.done?_.installActivateAddonAjax(e):l.done(function(t){return n.push(t),_.installActivateAddonAjax(e)}).fail(function(t){r.push(t)})}),l.done(function(t){n.push(t)}).fail(function(t){r.push(t)}).always(function(){e.close(),0<n.length&&wpf.listPluck(n,"success").every(Boolean)&&0===r.length?o(a,s):_.installActivateAddonsError(a,s,o)})},installActivateAddonsError:function(t,e,a){w.confirm({title:wpforms_form_templates.heads_up,content:wpforms_form_templates.template_addons_error,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.use_template,btnClass:"btn-confirm",keys:["enter"],action:function(){a(t,e)}},cancel:{text:wpforms_form_templates.cancel,action:function(){_.selectTemplateCancel()}}}})},installActivateAddonAjax:function(t){var e=wpforms_addons[t],a=new w.Deferred;return!e||["activate","install"].indexOf(e.action)<0?(a.resolve(!1),a.promise()):w.post(wpforms_form_templates.ajaxurl,{action:"wpforms_"+e.action+"_addon",nonce:wpforms_form_templates.admin_nonce,plugin:"activate"===e.action?t+"/"+t+".php":e.url})}};return _}((document,window),jQuery);WPFormsFormTemplates.init();